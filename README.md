# Hack-a-thing 1
## Description, Lessons, Takeaways, and 10 reasons why I cry & drink at night
This is a (WIP of) realtime anonymous chat webapp. It allows users to connect to the site and chat realtime, sort comments by date, with pagination & infinite scrolling (it loads 25 comments at a time in anti-chronological order). "Chat rooms" each correspond to a topic (which you can create) and you can look at your past comments to edit/delete them.

This seems like your normal CRUD webapp, and I suppose it is - I've been a longtime (vanilla) PHP & node + express programmer. However, in all of my projects the UI is rendered server-side (for PHP, just embedding PHP in HTML, and for express, using PUG + partials). Furthermore, I *always* made the UI functionality with lots and lots of spaghetti jQuery. AND, I almost always used relational databases (MySQL for PHP, Postgres for express) as the data store (I've dabbled in MongoDB before, but found it lacking in features, and it didn't really fit my data models too well).

*ALL OF THIS* went out the door with this project.

Server handling both backend & frontend code? No more! Now there's a clear separation between frontend and backend: the frontend is a SPA framework (Vue), hosted on its own and doing fancy things like real-time UI updates, 2-way data binding, transpiling (so I can use `require()` in client side code), routing directly on the frontend, infinite scrolling, syncing data store with the backend, making only API requests to the backend (and ONLY receiving data, not UI). The backend is now a pure API, which I could write the traditional REST API w/ node + express + pg, which I've written again and again and again, but I wanted to spice things up.

You ever see a dead animal on the road and yet just can't stop but be curious (and maybe even poke it with a stick)? You ever see a TV show/election/etc go horribly out of hand and yet can't turn your eyes off of the flaming dumpster? That's how I felt about "NoSQL technologies" (even Redis to a degree - debugging the god forsaken lua scripts...): I *knew* relational data model is the best suit for most applications' needs. I *knew* MySQL/Postgres has withstood the passage of time and was proven to be rock-solid, and I *knew* the documentation, tutorials and the myriad of questions on stackoverflow covered any problem I would've ever encountered. Most importantly, I *knew* how to work those databases (and their dialects of SQL, and their vendor-specific functions, and their vendor-specific features, etc.) inside out, and query them with PHP & node. I had it down to a *science*.

Redis was trashy, MongoDB was even worse, and DynamoDB... *blegh*. But the flamiest, trashiest of them all was CouchDB, for 1. no one used it, 2. the documentation was very scarce, 3. there's ZERO tutorials and questions out there, 4. the surrounding ecosystem was... practically nonexistent, 5. it was clunky and awkward to work with (to fiddle with index or user permissions you *insert* a *specifically* formatted document into the database, with a name that follows a *specific rule*, and hosted CouchDB - Cloudant - doesn't even allow you to add users programmatically), and 6. the data model was hella clunky (it was "technically" a document store, but the way it queries - mapreduce, lol - and indexes is much more akin to Redis than to MongoDB, albeit with the "speed" of MongoDB).

But it *was* known for being good at syncing data between clients & server (the instance on the client is *also* a source of truth - for it is a true master-master system *cough* MongoDB *cough*, with an eventual consistency tradeoff that I didn't mind one bit since it had MVCC), and one of the biggest pain points in writing any web app (for me anyways) has always been keeping shit updated (the UI, the data, etc., which was why I always preferred to do server-side rendering, so only the server-side needs to keep track of data & UI), and with "separation of concern"/"decoupling" between frontend and backend, it was even going to get *worse*.

So hey, CouchDB to the rescue! The setup and configuration are clunky, but at least it can take care of *that* one paint point (with the bonus that it can be our *only* backend, removing the need for me to write yet another express server), plus I've always heard good things about Vue (React was just *way* too intimidating for me - even worse than Vue, and considering I never adopted Laravel framework partially due to the sheer intimidation of Vue, you could see just how I wanted to stay the hell away from it), and this PouchDB thing (which seemed like a "seamless CouchDB client") should help, right?

The first knockout punch from setting up Vue. "Just include the Vue file in your html, and start using Vue!" Except if you ever want to use components (and shit really gets complicated real quick without them), or include many different libraries without having to manually update version numbers by hand (I'll take `require('pouchdb')` over `<script src="https://blahblahblah.cdn.blah/pouchdb/dist/X.Y.Z.min.js></script>` bullshit any day of the week), you *have* to somehow compile that shit to regular js. And god forbid you *actually* try to set up your own webpack config to compile Vue & browser libraries into a single file, especially when you've only used Browserify your entire life and haven't even looked at Webpack due to the sheer size & intimidation of it all...

So unless you want to go down the depths of hell that is 200 line `babel.config.js`, you have to rely on some sort of template someone else made for you. Introducing Vue-Cli, the perfect candidate for the problem! It scaffolds everything you need, from configurating Webpack to setting up component hierarchies and loading them through magic! Wait, I didn't *want* magic in my code - aw shit, now I have to figure out how they wired together this mess of specific hierarchies of Vue components and random js files. "Progressive framework", they said. "Adopt incrementally without fear of having to drop into the depths of framework hell", they said.

But wait! Just when I thought I figured it out, I realized I need *some* way of routing all this shit, and in comes Vue-Router! Now I have to delete the project and make it again with Vue-Cli (to include Vue-Router), and *then* wire it up! Although I was hoping to have a drastic departure from jQuery spaghetty by moving to a SPA, the very fact that I had to include routing in my frontend marked the return of the spaghetty, *with a vengeance*. Questions such as "How do I redirect users to the login page when they're not logged in?", "How do I set default/conditional redirects to other pages without having to create a view Vue component for every single one of the routes?", "How do I force Vue to *actually* recognize the two different routes and work as intended when I move between two URLs of the form `/basepath/:path_parameter`? These questions led me down to the depths of Vue spaghetty hell.

And of course, Bootstrap *always* sucks no matter how many times I use it (it *always* takes hours to get shit right). The documentation is always wrong (especially in regards to spacing), so I end up having to copy + paste snippets from a bunch of my old projects, but it sure as hell beats having to learn another CSS framework, god damn.

Oh, and what about syncing the actual data between client & server, *and* reflecting those changes in the UI? And working with PouchDB, with authentication, with a hosted instance of CouchDB (which never worked after hours of debugging so I dropped it)? These issues alone demand at least 10 paragraphs of complaints, but I'm running out of steam as I write this.

So, in the end, I spent *wayyyyyyy* too much time (20+ hours between all the coding, erasing, restarting project, debugging, reading documentation, *finding* documentation and tutorials and existing setups, and if all failed, reading the goddamn source codes) on something that's really supposed to be simple, and yet I haven't even managed to complete the MVP (please have mercy on me). So what did I learn?
- how to build a frontend SPA (decoupled from the backend) and handle Vue framework setup + transpiling, wiring Vue components, actual 2-way data binding and auto-updating UI (which I ended up having to write on my own anyway), routing, bootstrap integration, and using infinite scrolls
- data modeling with CouchDB; specifically, the use of what is essentially a key-value store to manage documents, admin & user management, working with indices, synchronizing between different instances (one on the client, one on the server), reflecting changes into the UI framework, the godawful and archaic authentication, etc.
- combining the above two to create real-time UI
- the one thing I *did* manage to actually get it right all the way to the end, is allowing clients to connect without credentials, and anonymously, by using the browser/device itself as the key. Imagine using Slack, except you didn't have to sign up for it - you could jump right in with just a username, lowering barrier to entry for most people

Takeaways? Stick with what I know and do best - building "traditional" webapps, unless there's a specific, dire *need* to change otherwise. Use technologies where they fit - for instance, device fingerprinting really fit my needs that were previously unmet by any tools in my toolbox, while CouchDB... or really any noSQL "databases" for that matter, really only serve very *small, specific* niches and even then for the most part, what I know - relational databases - will serve me best. Also, libraries, community support, & documentation matter. They matter *so much*! They are probably even more important than the quality of the actual product itself, so do extensive research before I jump in (I got lucky with PHP & node/express)!

## Authors
- Project manager: Sungil Ahn
- Lead programmer: Sungil Ahn
- Jr. programmer: Sungil Ahn
- UI/frontend: Sungil Ahn
- Tester & debugger: Sungil Ahn
- Documentation writer: Sungil Ahn
- Head basher: Sungil Ahn

## Tut-O'real
I just scoured the reference documentations (and in some cases, source codes) for `Vue.js`, `Vue-cli`, `Webpack`, `Vue-router`, `Bootstrap-Vue`, `Vue-infinite-scroll`, `PouchDB`, `PouchDB-authentication`, `fingerprintjs2` *because there ***were*** no tutorials*. What a god awful ordeal...
